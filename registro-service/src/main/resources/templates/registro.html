<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="UTF-8" />
    <title>Registro de Usuario</title>

    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;500;700&display=swap" rel="stylesheet">

    <style>
        *, *::before, *::after { box-sizing: border-box; }
        html,body { height:100%; margin:0; font-family: "Poppins", Arial, sans-serif; -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale; }

        :root{
            --accent: #6a28c6;
            --accent-dark: #4b0fa0;
            --muted: #9aa0b4;
            --card-bg: rgba(255,255,255,0.92);
            --glass-border: rgba(0,0,0,0.04);
            --green: #06bfa6;
        }

        .hero {
            min-height:100vh;
            display:flex;
            align-items:center;
            justify-content:center;
            background: linear-gradient(180deg,#f3eef9 0%, #f6f8fb 100%);
            padding:40px;
        }

        .container {
            width:100%;
            max-width:1200px;
            display:grid;
            grid-template-columns: 1fr 460px;
            gap:36px;
            align-items:center;
        }

        .left {
            position:relative;
            height:70vh;
            min-height:480px;
            border-radius:18px;
            overflow:hidden;
            background: linear-gradient(180deg, rgba(106,40,198,0.06) 0%, rgba(16,24,64,0.01) 100%);
            display:flex;
            align-items:flex-end;
            justify-content:flex-start;
            background-size: cover;
            background-position: center;
        }
        .left .overlay-shape {
            position:absolute;
            left:0;
            bottom:0;
            height:38%;
            width:100%;
            background: linear-gradient(180deg,#23b07b 0%, #0ea57a 100%);
            clip-path: polygon(0 40%, 12% 28%, 30% 46%, 52% 30%, 72% 50%, 100% 30%, 100% 100%, 0% 100%);
            opacity:0.95;
        }

        .card {
            position:relative;
            padding:34px 36px;
            border-radius:20px;
            background: var(--card-bg);
            box-shadow: 0 24px 60px rgba(16,24,64,0.14);
            border: 1px solid var(--glass-border);
            backdrop-filter: blur(6px) saturate(120%);
            -webkit-backdrop-filter: blur(6px) saturate(120%);
            min-height:480px;
            display:flex;
            flex-direction:column;
            justify-content:flex-start;
            gap:10px;
        }

        .title {
            font-size:32px;
            font-weight:700;
            color:var(--accent);
            text-align:center;
            margin-top:4px;
            margin-bottom:4px;
            letter-spacing:1px;
        }
        .subtitle {
            text-align:center;
            font-size:16px;
            font-weight:600;
            color:#5a3a8b;
            margin-bottom:12px;
        }

        .roles {
            display:flex;
            gap:12px;
            justify-content:center;
            margin-bottom:6px;
        }
        .role {
            flex:1;
            min-width:0;
            display:flex;
            flex-direction:column;
            align-items:center;
            justify-content:center;
            padding:12px;
            border-radius:12px;
            border:2px solid rgba(106,40,198,0.12);
            background: rgba(255,255,255,0.6);
            cursor:pointer;
            transition: all .18s ease;
            font-weight:600;
            color:#6b6f7d;
        }
        .role.active {
            background: linear-gradient(180deg, rgba(106,40,198,0.06), rgba(106,40,198,0.02));
            border-color: var(--accent);
            color: var(--accent);
            box-shadow: 0 8px 24px rgba(106,40,198,0.06);
        }

        label {
            display:block;
            width:100%;
            color:#5f6571;
            font-size:13px;
            font-weight:500;
            margin:8px 0 6px 0;
        }

        .input-group {
            position:relative;
            width:100%;
            margin-bottom:10px;
        }

        .input-group svg { position:absolute; left:12px; top:50%; transform:translateY(-50%); width:18px; height:18px; opacity:0.6; }

        input[type="text"], input[type="email"], input[type="password"], select {
            width:100%;
            padding:12px 14px 12px 44px; 
            border-radius:10px;
            border:1px solid rgba(16,24,64,0.06);
            background: #fff;
            font-size:14px;
            color:#222;
            outline:none;
            transition:all .14s ease;
            box-shadow: 0 6px 18px rgba(16,24,64,0.04);
        }

        input::placeholder { color:#bfc6d4; }

        input:focus, select:focus {
            border-color: rgba(106,40,198,0.55);
            box-shadow: 0 10px 28px rgba(106,40,198,0.06);
        }

        .btn-primary {
            width:100%;
            padding:12px;
            margin-top:12px;
            border-radius:10px;
            border:none;
            background: linear-gradient(180deg, var(--accent) 0%, var(--accent-dark) 100%);
            color:white;
            font-weight:700;
            font-size:15px;
            cursor:pointer;
            box-shadow: 0 10px 30px rgba(106,40,198,0.18);
        }
        .btn-primary:hover { transform: translateY(-2px); }

        .foot {
            margin-top:14px;
            text-align:center;
            color:var(--muted);
            font-size:14px;
        }
        .foot a { color:var(--green); text-decoration:none; font-weight:700; }

        #msg { margin-top:8px; min-height:36px; text-align:center; font-size:14px; border-radius:8px; padding:6px 10px; display:inline-block; }

        @media (max-width:980px) {
            .container { grid-template-columns: 1fr; gap:18px; padding:10px; }
            .left { order:2; min-height:300px; height:42vh; }
            .card { order:1; min-height:420px; width:100%; }
            .roles { flex-direction:row; }
        }
        @media (max-width:520px) {
            .card { padding:20px; border-radius:14px; }
            .title { font-size:26px; }
        }
    </style>
</head>

<body>
    <div class="hero">
        <div class="container">

            <div class="left" th:style="|background-image: url('@{/Imagenes/Registro.png}');|">
                <div class="overlay-shape" aria-hidden="true"></div>
            </div>

            <div class="card">
                <div class="title">Registrarse</div>
                <div class="subtitle">&nbsp;</div>

                <div class="roles" id="roles">
                    <div class="role" data-role="CLIENTE" id="role-cliente">
                        <div style="font-size:13px; color:#9aa0b4; margin-bottom:6px;">Quiero contratar un servicio</div>
                        <div style="font-size:14px;">Cliente</div>
                    </div>
                    <div class="role" data-role="EMPLEADO" id="role-empleado">
                        <div style="font-size:13px; color:#9aa0b4; margin-bottom:6px;">Quiero ofrecer un servicio</div>
                        <div style="font-size:14px;">Empleado</div>
                    </div>
                </div>

                <form th:action="@{/auth/registrar}" method="post" id="registroForm">
                    <label for="nombre">Nombre:</label>
                    <div class="input-group">
                        <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
                            <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2" stroke="#6b6f7d" stroke-width="1.2" stroke-linecap="round" stroke-linejoin="round"/>
                            <circle cx="12" cy="7" r="4" stroke="#6b6f7d" stroke-width="1.2" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                        <input id="nombre" name="nombre" type="text" required placeholder="Nombre">
                    </div>

                    <label for="apellido">Apellido:</label>
                    <div class="input-group">
                        <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
                            <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2" stroke="#6b6f7d" stroke-width="1.2" stroke-linecap="round" stroke-linejoin="round"/>
                            <circle cx="12" cy="7" r="4" stroke="#6b6f7d" stroke-width="1.2" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                        <input id="apellido" name="apellido" type="text" required placeholder="Apellido">
                    </div>

                    <label for="email">Email:</label>
                    <div class="input-group">
                        <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
                            <path d="M3 6.5C3 5.67 3.67 5 4.5 5H19.5C20.33 5 21 5.67 21 6.5V17.5C21 18.33 20.33 19 19.5 19H4.5C3.67 19 3 18.33 3 17.5V6.5Z" stroke="#6b6f7d" stroke-width="1.2" stroke-linecap="round" stroke-linejoin="round"/>
                            <path d="M21 6L12 12.5L3 6" stroke="#6b6f7d" stroke-width="1.2" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                        <input id="email" name="email" type="email" required placeholder="Email">
                    </div>

                    <label for="password">Contraseña:</label>
                    <div class="input-group">
                        <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
                            <path d="M2 12s4-7 10-7 10 7 10 7-4 7-10 7S2 12 2 12z" stroke="#6b6f7d" stroke-width="1.2" stroke-linecap="round" stroke-linejoin="round"/>
                            <circle cx="12" cy="12" r="3" stroke="#6b6f7d" stroke-width="1.2"/>
                        </svg>
                        <input id="password" name="password" type="password" required placeholder="Contraseña">
                    </div>

                    <label for="dni">DNI:</label>
                    <div class="input-group">
                        <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
                            <rect x="3" y="4" width="18" height="16" rx="2" stroke="#6b6f7d" stroke-width="1.2"/>
                            <path d="M8 7h8" stroke="#6b6f7d" stroke-width="1.2" stroke-linecap="round"/>
                        </svg>
                        <input id="dni" name="dni" maxlength="8" type="text" required placeholder="DNI">
                    </div>

                    <label for="rol">Rol:</label>
                    <div class="input-group" style="margin-bottom:6px;">
                        <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
                            <path d="M12 2v6" stroke="#6b6f7d" stroke-width="1.2" stroke-linecap="round"/>
                            <path d="M6 22v-7h12v7" stroke="#6b6f7d" stroke-width="1.2" stroke-linecap="round"/>
                        </svg>
                        <select id="rol" name="rol">
                            <option value="CLIENTE">Cliente</option>
                            <option value="EMPLEADO">Empleado</option>
                        </select>
                    </div>

                    <button type="submit" class="btn-primary">Registrarme</button>
                </form>

                <div id="msg" role="status"></div>

                <p class="foot">
                    ¿Ya tienes cuenta?
                    <a href="http://localhost:8081/auth/login">Inicia sesión aquí</a>
                </p>
            </div>
        </div>
    </div>

    <script>

        document.querySelector("form").addEventListener("submit", function (e) {
            e.preventDefault();
            const data = {
                nombre: this.nombre.value,
                apellido: this.apellido.value,
                email: this.email.value,
                password: this.password.value,
                dni: this.dni.value,
                rol: this.rol.value
            };

            fetch("/auth/registrar", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify(data)
            })
                .then(res => res.text())
                .then(msg => {
                    const box = document.getElementById('msg');
                    box.textContent = msg;
                    box.style.color = '#05589c';
                    box.style.background = 'rgba(224,243,255,0.6)';
                    box.style.padding = '8px 12px';
                    box.style.borderRadius = '8px';
                })
                .catch(err => {
                    const box = document.getElementById('msg');
                    box.textContent = "Error: " + err;
                    box.style.color = '#9b2c2c';
                    box.style.background = 'rgba(255,228,228,0.7)';
                    box.style.padding = '8px 12px';
                    box.style.borderRadius = '8px';
                });
        });

        (function(){
            const roleCliente = document.getElementById('role-cliente');
            const roleEmpleado = document.getElementById('role-empleado');
            const selectRol = document.getElementById('rol');

            function setActive(role){
                if(role === 'CLIENTE'){
                    roleCliente.classList.add('active');
                    roleEmpleado.classList.remove('active');
                    selectRol.value = 'CLIENTE';
                } else {
                    roleEmpleado.classList.add('active');
                    roleCliente.classList.remove('active');
                    selectRol.value = 'EMPLEADO';
                }
            }

            setActive(selectRol.value);

            roleCliente.addEventListener('click', () => setActive('CLIENTE'));
            roleEmpleado.addEventListener('click', () => setActive('EMPLEADO'));

            selectRol.addEventListener('change', (e) => setActive(e.target.value));
        })();
    </script>
</body>
</html>